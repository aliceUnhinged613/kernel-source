From: Olaf Hering <yousaf.kaukab@suse.com>
Date: Fri Jul 10 08:08:08 UTC 2020
Subject: kabi: hv: prevent struct device_node to become defined
Patch-mainline: Never, kabi
References: bsc#1172871
  
Prevent following kabi breakage:
  
KABI: symbol vmbus_are_subchannels_present(mod:drivers/hv/hv_vmbus) changed crc from 0x07db3f8f to 0xf5735051
KABI: symbol vmbus_hvsock_device_unregister(mod:drivers/hv/hv_vmbus) changed crc from 0x2e1db501 to 0xaef287e2
KABI: symbol vmbus_set_chn_rescind_callback(mod:drivers/hv/hv_vmbus) changed crc from 0x8f480c9e to 0x043a1948
KABI: symbol vmbus_set_event(mod:drivers/hv/hv_vmbus) changed crc from 0x7bec4282 to 0x38d20f5a
KABI: symbol vmbus_set_sc_create_callback(mod:drivers/hv/hv_vmbus) changed crc from 0x66476229 to 0x88cc767c
KABI: aborting due to kabi changes.
Detailed kabi warnings:
drivers/hv/connection.c:478: warning: vmbus_set_event: modversion changed because of changes in struct device_node (became defined), struct irq_domain (became defined)
drivers/hv/channel_mgmt.c:1139: warning: vmbus_hvsock_device_unregister: modversion changed because of changes in struct device_node (became defined), struct irq_domain (became defined)
drivers/hv/channel_mgmt.c:1445: warning: vmbus_set_sc_create_callback: modversion changed because of changes in struct device_node (became defined), struct irq_domain (became defined)
drivers/hv/channel_mgmt.c:1464: warning: vmbus_are_subchannels_present: modversion changed because of changes in struct device_node (became defined), struct irq_domain (became defined)
drivers/hv/channel_mgmt.c:1471: warning: vmbus_set_chn_rescind_callback: modversion changed because of changes in struct device_node (became defined), struct irq_domain (became defined)

Fixes commit 1cf106d93245f436c10e73cd3d4b885067d4bbcc 
--- a/arch/x86/include/asm/mshyperv.h
+++ b/arch/x86/include/asm/mshyperv.h
@@ -4,7 +4,9 @@
 #include <linux/types.h>
 #include <linux/atomic.h>
 #include <linux/nmi.h>
+#ifndef __GENKSYMS__
 #include <linux/msi.h>
+#endif
 #include <asm/io.h>
 #include <asm/hyperv-tlfs.h>
 #include <asm/nospec-branch.h>
